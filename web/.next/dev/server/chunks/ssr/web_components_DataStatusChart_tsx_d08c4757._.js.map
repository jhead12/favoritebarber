{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/PRO-BLADE/Github/RateYourBarber/web/components/DataStatusChart.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\n\ntype Props = {\n  endpoint?: string;\n};\n\nexport default function DataStatusChart({ endpoint = '/api/admin/data-status' }: Props) {\n  const [data, setData] = useState<any | null>(null);\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const chartRef = useRef<any>(null);\n\n  useEffect(() => {\n    let mounted = true;\n    (async () => {\n      try {\n        const res = await fetch(endpoint);\n        if (!res.ok) throw new Error('fetch failed');\n        const j = await res.json();\n        if (!mounted) return;\n        setData(j);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n    return () => { mounted = false; };\n  }, [endpoint]);\n\n  useEffect(() => {\n    if (!data || !canvasRef.current) return;\n    // Lazy-load Chart.js to avoid forcing dependency for all dev setups\n    let cancelled = false;\n    (async () => {\n      try {\n        const Chart = (await import('chart.js/auto')).default;\n        if (cancelled) return;\n        const ctx = canvasRef.current!.getContext('2d')!;\n        if (chartRef.current) chartRef.current.destroy();\n\n        const labels = ['<20', '20-39', '40-59', '60-79', '80+'];\n        const values = [\n          data.distr.lt20 || 0,\n          data.distr.bt20_40 || 0,\n          data.distr.bt40_60 || 0,\n          data.distr.bt60_80 || 0,\n          data.distr.gte80 || 0,\n        ];\n\n        chartRef.current = new Chart(ctx, {\n          type: 'bar',\n          data: {\n            labels,\n            datasets: [{ label: 'Barber trust distribution', data: values, backgroundColor: ['#ef4444','#f59e0b','#facc15','#34d399','#60a5fa'] }]\n          },\n          options: { responsive: true, maintainAspectRatio: false }\n        });\n      } catch (e) {\n        console.error('Chart load failed', e);\n      }\n    })();\n    return () => { cancelled = true; if (chartRef.current) chartRef.current.destroy(); };\n  }, [data]);\n\n  if (!data) return <div>Loading dashboardâ€¦</div>;\n\n  const totalBarbers = Number(data.counts.barbers_count || 0);\n  const values = [\n    Number(data.distr.lt20 || 0),\n    Number(data.distr.bt20_40 || 0),\n    Number(data.distr.bt40_60 || 0),\n    Number(data.distr.bt60_80 || 0),\n    Number(data.distr.gte80 || 0),\n  ];\n\n  return (\n    <div style={{ padding: 20 }}>\n      <h2 style={{ marginBottom: 6 }}>Data Collections</h2>\n      <div style={{ display: 'flex', gap: 18, alignItems: 'center', marginBottom: 12 }}>\n        <div style={{ fontSize: 14, color: '#374151' }}>\n          <div><strong>Barbers</strong>: {data.counts.barbers_count}</div>\n          <div><strong>Shops</strong>: {data.counts.shops_count}</div>\n          <div><strong>Locations</strong>: {data.counts.locations_count}</div>\n          <div><strong>Images</strong>: {data.counts.images_count}</div>\n          <div><strong>Reviews</strong>: {data.counts.reviews_count}</div>\n        </div>\n        <div style={{ fontSize: 14, color: '#374151' }}>\n          <div>Avg barber trust: <strong>{Number(data.aggs.avg_barber_trust || 0).toFixed(1)}</strong></div>\n          <div>Avg shop trust: <strong>{Number(data.aggs.avg_shop_trust || 0).toFixed(1)}</strong></div>\n          <div>Locations verified: <strong>{Number(data.verified.pct_locations_verified || 0).toFixed(1)}%</strong></div>\n        </div>\n      </div>\n\n      <div style={{ display: 'flex', gap: 20, alignItems: 'flex-start' }}>\n        <div style={{ width: '60%', height: 360, background: '#fff', padding: 12, borderRadius: 8, boxShadow: '0 6px 18px rgba(2,6,23,0.08)' }}>\n          <canvas ref={canvasRef} />\n        </div>\n        <div style={{ width: '35%' }}>\n          <div style={{ background: '#fff', padding: 12, borderRadius: 8, boxShadow: '0 6px 18px rgba(2,6,23,0.08)' }}>\n            <h4 style={{ marginTop: 0 }}>Legend</h4>\n            {['<20', '20-39', '40-59', '60-79', '80+'].map((lbl, i) => (\n              <div key={lbl} style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 8 }}>\n                <div style={{ width: 18, height: 12, background: ['#ef4444','#f59e0b','#facc15','#34d399','#60a5fa'][i], borderRadius: 3 }} />\n                <div style={{ flex: 1 }}>{lbl}</div>\n                <div style={{ fontWeight: 700 }}>{values[i]}{totalBarbers ? ` (${((values[i]/totalBarbers)*100).toFixed(1)}%)` : ''}</div>\n              </div>\n            ))}\n            <hr />\n            <small style={{ color: '#6b7280' }}>This chart shows the distribution of barber trust scores across the dataset. Higher trust indicates better reliability based on aggregated signals.</small>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}