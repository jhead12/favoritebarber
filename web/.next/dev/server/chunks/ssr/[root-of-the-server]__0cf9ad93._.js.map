{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/PRO-BLADE/Github/RateYourBarber/web/lib/adapters.ts"],"sourcesContent":["// web/lib/adapters.ts\n// Central adapters to convert API shapes to UI shapes\n\nexport type UiBarber = {\n  id: string | number;\n  name: string;\n  shop: string;\n  distance: string;\n  trust: number;\n  specialties: any[];\n  price: string;\n  thumb: string;\n};\n\nexport function mapApiBarberToUi(b: any): UiBarber {\n  // DB-backed barber\n  if (b && (b.trust_score || b.thumbnail_url || b.distance_m !== undefined)) {\n    const trustVal = b.trust_score ? (typeof b.trust_score.value === 'number' ? b.trust_score.value : Number(b.trust_score.value)) : 0;\n    // Normalize shop field: it may be an object (shop row) or a string\n    let shopStr = '';\n    if (b.primary_location && b.primary_location.formatted_address) shopStr = b.primary_location.formatted_address;\n    else if (b.shop) {\n      if (typeof b.shop === 'string') shopStr = b.shop;\n      else if (typeof b.shop === 'object') shopStr = b.shop.name || b.shop.formatted_address || JSON.stringify({ id: b.shop.id }).replace(/[{}\\\"]+/g, '') || '';\n    }\n\n    return {\n      id: b.id,\n      name: b.name || '',\n      shop: shopStr,\n      distance: b.distance_m ? `${(b.distance_m/1609).toFixed(1)} mi` : (b.distance || ''),\n      trust: Number.isFinite(trustVal) ? trustVal : 0,\n      specialties: b.top_tags || b.specialties || [],\n      price: b.price || '$$?',\n      thumb: b.thumbnail_url || b.image_url || b.thumb || '',\n    };\n  }\n\n  // Yelp-like result\n  return {\n    id: b.id,\n    name: b.name || '',\n    shop: b.address || '',\n    distance: b.distance_m ? `${(b.distance_m/1609).toFixed(1)} mi` : (b.distance || ''),\n    trust: Math.min(100, Math.round((b.rating || 0) / 5 * 100)),\n    specialties: b.categories || [],\n    price: b.price || '$$?',\n    thumb: b.image_url || '',\n  };\n}\n"],"names":[],"mappings":"AAAA,sBAAsB;AACtB,sDAAsD;;;;;AAa/C,SAAS,iBAAiB,CAAM;IACrC,mBAAmB;IACnB,IAAI,KAAK,CAAC,EAAE,WAAW,IAAI,EAAE,aAAa,IAAI,EAAE,UAAU,KAAK,SAAS,GAAG;QACzE,MAAM,WAAW,EAAE,WAAW,GAAI,OAAO,EAAE,WAAW,CAAC,KAAK,KAAK,WAAW,EAAE,WAAW,CAAC,KAAK,GAAG,OAAO,EAAE,WAAW,CAAC,KAAK,IAAK;QACjI,mEAAmE;QACnE,IAAI,UAAU;QACd,IAAI,EAAE,gBAAgB,IAAI,EAAE,gBAAgB,CAAC,iBAAiB,EAAE,UAAU,EAAE,gBAAgB,CAAC,iBAAiB;aACzG,IAAI,EAAE,IAAI,EAAE;YACf,IAAI,OAAO,EAAE,IAAI,KAAK,UAAU,UAAU,EAAE,IAAI;iBAC3C,IAAI,OAAO,EAAE,IAAI,KAAK,UAAU,UAAU,EAAE,IAAI,CAAC,IAAI,IAAI,EAAE,IAAI,CAAC,iBAAiB,IAAI,KAAK,SAAS,CAAC;gBAAE,IAAI,EAAE,IAAI,CAAC,EAAE;YAAC,GAAG,OAAO,CAAC,YAAY,OAAO;QACzJ;QAEA,OAAO;YACL,IAAI,EAAE,EAAE;YACR,MAAM,EAAE,IAAI,IAAI;YAChB,MAAM;YACN,UAAU,EAAE,UAAU,GAAG,GAAG,CAAC,EAAE,UAAU,GAAC,IAAI,EAAE,OAAO,CAAC,GAAG,GAAG,CAAC,GAAI,EAAE,QAAQ,IAAI;YACjF,OAAO,OAAO,QAAQ,CAAC,YAAY,WAAW;YAC9C,aAAa,EAAE,QAAQ,IAAI,EAAE,WAAW,IAAI,EAAE;YAC9C,OAAO,EAAE,KAAK,IAAI;YAClB,OAAO,EAAE,aAAa,IAAI,EAAE,SAAS,IAAI,EAAE,KAAK,IAAI;QACtD;IACF;IAEA,mBAAmB;IACnB,OAAO;QACL,IAAI,EAAE,EAAE;QACR,MAAM,EAAE,IAAI,IAAI;QAChB,MAAM,EAAE,OAAO,IAAI;QACnB,UAAU,EAAE,UAAU,GAAG,GAAG,CAAC,EAAE,UAAU,GAAC,IAAI,EAAE,OAAO,CAAC,GAAG,GAAG,CAAC,GAAI,EAAE,QAAQ,IAAI;QACjF,OAAO,KAAK,GAAG,CAAC,KAAK,KAAK,KAAK,CAAC,CAAC,EAAE,MAAM,IAAI,CAAC,IAAI,IAAI;QACtD,aAAa,EAAE,UAAU,IAAI,EAAE;QAC/B,OAAO,EAAE,KAAK,IAAI;QAClB,OAAO,EAAE,SAAS,IAAI;IACxB;AACF"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/PRO-BLADE/Github/RateYourBarber/web/pages/shop/%5Bid%5D.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport { mapApiBarberToUi, UiBarber } from '../../lib/adapters';\nimport { setLastVisitedBarber } from '../../lib/lastVisited';\n\nexport default function ShopPage(): JSX.Element {\n  const router = useRouter();\n  const { id } = router.query;\n  const [barber, setBarber] = useState<UiBarber | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!id) return;\n\n    async function load() {\n      setLoading(true);\n      setError(null);\n      try {\n        const apiBase = process.env.NEXT_PUBLIC_API_URL || '';\n        const res = await fetch(`${apiBase}/api/barbers/${id}`);\n        if (res.status === 404) {\n          setError('Barber not found');\n          setBarber(null);\n        } else if (!res.ok) {\n          throw new Error(`fetch failed: ${res.status}`);\n        } else {\n          const raw = await res.json();\n          setBarber(mapApiBarberToUi(raw));\n          try {\n            setLastVisitedBarber({ id: raw.id, name: raw.name || '', shop: (raw.primary_location && raw.primary_location.formatted_address) || '', timestamp: Date.now() });\n          } catch (e) {}\n        }\n      } catch (err: any) {\n        setError(err.message || String(err));\n        setBarber(null);\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    load();\n  }, [id]);\n\n  if (loading) return <div>Loading shop...</div>;\n  if (error) return <div>Error: {error}</div>;\n  if (!barber) return <div>No barber data available</div>;\n\n  return (\n    <main style={{ padding: 20 }}>\n      <div style={{ marginBottom: 12 }}>\n        <button onClick={() => router.back()} style={{ padding: '6px 10px' }}>‚Üê Back</button>\n      </div>\n      <h1>{barber.name}</h1>\n      <p><strong>Shop:</strong> {barber.shop}</p>\n      <p><strong>Distance:</strong> {barber.distance}</p>\n      <p><strong>Trust:</strong> {barber.trust}</p>\n      <p><strong>Specialties:</strong> {barber.specialties?.join ? barber.specialties.join(', ') : JSON.stringify(barber.specialties)}</p>\n      {barber.thumb ? <img src={barber.thumb} alt={`${barber.name} thumbnail`} style={{ maxWidth: 300 }} /> : null}\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;AAEe,SAAS;IACtB,MAAM,SAAS,IAAA,2IAAS;IACxB,MAAM,EAAE,EAAE,EAAE,GAAG,OAAO,KAAK;IAC3B,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+GAAQ,EAAkB;IACtD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,+GAAQ,EAAgB;IAElD,IAAA,gHAAS,EAAC;QACR,IAAI,CAAC,IAAI;QAET,eAAe;YACb,WAAW;YACX,SAAS;YACT,IAAI;gBACF,MAAM,UAAU,6DAAmC;gBACnD,MAAM,MAAM,MAAM,MAAM,GAAG,QAAQ,aAAa,EAAE,IAAI;gBACtD,IAAI,IAAI,MAAM,KAAK,KAAK;oBACtB,SAAS;oBACT,UAAU;gBACZ,OAAO,IAAI,CAAC,IAAI,EAAE,EAAE;oBAClB,MAAM,IAAI,MAAM,CAAC,cAAc,EAAE,IAAI,MAAM,EAAE;gBAC/C,OAAO;oBACL,MAAM,MAAM,MAAM,IAAI,IAAI;oBAC1B,UAAU,IAAA,mIAAgB,EAAC;oBAC3B,IAAI;wBACF,IAAA,0IAAoB,EAAC;4BAAE,IAAI,IAAI,EAAE;4BAAE,MAAM,IAAI,IAAI,IAAI;4BAAI,MAAM,AAAC,IAAI,gBAAgB,IAAI,IAAI,gBAAgB,CAAC,iBAAiB,IAAK;4BAAI,WAAW,KAAK,GAAG;wBAAG;oBAC/J,EAAE,OAAO,GAAG,CAAC;gBACf;YACF,EAAE,OAAO,KAAU;gBACjB,SAAS,IAAI,OAAO,IAAI,OAAO;gBAC/B,UAAU;YACZ,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG;QAAC;KAAG;IAEP,IAAI,SAAS,qBAAO,qKAAC;kBAAI;;;;;;IACzB,IAAI,OAAO,qBAAO,qKAAC;;YAAI;YAAQ;;;;;;;IAC/B,IAAI,CAAC,QAAQ,qBAAO,qKAAC;kBAAI;;;;;;IAEzB,qBACE,qKAAC;QAAK,OAAO;YAAE,SAAS;QAAG;;0BACzB,qKAAC;gBAAI,OAAO;oBAAE,cAAc;gBAAG;0BAC7B,cAAA,qKAAC;oBAAO,SAAS,IAAM,OAAO,IAAI;oBAAI,OAAO;wBAAE,SAAS;oBAAW;8BAAG;;;;;;;;;;;0BAExE,qKAAC;0BAAI,OAAO,IAAI;;;;;;0BAChB,qKAAC;;kCAAE,qKAAC;kCAAO;;;;;;oBAAc;oBAAE,OAAO,IAAI;;;;;;;0BACtC,qKAAC;;kCAAE,qKAAC;kCAAO;;;;;;oBAAkB;oBAAE,OAAO,QAAQ;;;;;;;0BAC9C,qKAAC;;kCAAE,qKAAC;kCAAO;;;;;;oBAAe;oBAAE,OAAO,KAAK;;;;;;;0BACxC,qKAAC;;kCAAE,qKAAC;kCAAO;;;;;;oBAAqB;oBAAE,OAAO,WAAW,EAAE,OAAO,OAAO,WAAW,CAAC,IAAI,CAAC,QAAQ,KAAK,SAAS,CAAC,OAAO,WAAW;;;;;;;YAC7H,OAAO,KAAK,iBAAG,qKAAC;gBAAI,KAAK,OAAO,KAAK;gBAAE,KAAK,GAAG,OAAO,IAAI,CAAC,UAAU,CAAC;gBAAE,OAAO;oBAAE,UAAU;gBAAI;;;;;uBAAQ;;;;;;;AAG9G"}}]
}