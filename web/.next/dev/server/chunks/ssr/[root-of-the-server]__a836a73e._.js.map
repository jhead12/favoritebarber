{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/PRO-BLADE/Github/RateYourBarber/web/lib/adapters.ts"],"sourcesContent":["// web/lib/adapters.ts\n// Central adapters to convert API shapes to UI shapes\n\nexport type UiBarber = {\n  id: string | number;\n  name: string;\n  shop: string;\n  distance: string;\n  trust: number;\n  specialties: any[];\n  price: string;\n  thumb: string;\n};\n\nexport function mapApiBarberToUi(b: any): UiBarber {\n  // DB-backed barber\n  if (b && (b.trust_score || b.thumbnail_url || b.distance_m !== undefined)) {\n    const trustVal = b.trust_score ? (typeof b.trust_score.value === 'number' ? b.trust_score.value : Number(b.trust_score.value)) : 0;\n    // Normalize shop field: it may be an object (shop row) or a string\n    let shopStr = '';\n    if (b.primary_location && b.primary_location.formatted_address) shopStr = b.primary_location.formatted_address;\n    else if (b.shop) {\n      if (typeof b.shop === 'string') shopStr = b.shop;\n      else if (typeof b.shop === 'object') shopStr = b.shop.name || b.shop.formatted_address || JSON.stringify({ id: b.shop.id }).replace(/[{}\\\"]+/g, '') || '';\n    }\n\n    return {\n      id: b.id,\n      name: b.name || '',\n      shop: shopStr,\n      distance: b.distance_m ? `${(b.distance_m/1609).toFixed(1)} mi` : (b.distance || ''),\n      trust: Number.isFinite(trustVal) ? trustVal : 0,\n      specialties: b.top_tags || b.specialties || [],\n      price: b.price || '$$?',\n      thumb: b.thumbnail_url || b.image_url || b.thumb || '',\n    };\n  }\n\n  // Yelp-like result\n  return {\n    id: b.id,\n    name: b.name || '',\n    shop: b.address || '',\n    distance: b.distance_m ? `${(b.distance_m/1609).toFixed(1)} mi` : (b.distance || ''),\n    trust: Math.min(100, Math.round((b.rating || 0) / 5 * 100)),\n    specialties: b.categories || [],\n    price: b.price || '$$?',\n    thumb: b.image_url || '',\n  };\n}\n"],"names":[],"mappings":"AAAA,sBAAsB;AACtB,sDAAsD;;;;;AAa/C,SAAS,iBAAiB,CAAM;IACrC,mBAAmB;IACnB,IAAI,KAAK,CAAC,EAAE,WAAW,IAAI,EAAE,aAAa,IAAI,EAAE,UAAU,KAAK,SAAS,GAAG;QACzE,MAAM,WAAW,EAAE,WAAW,GAAI,OAAO,EAAE,WAAW,CAAC,KAAK,KAAK,WAAW,EAAE,WAAW,CAAC,KAAK,GAAG,OAAO,EAAE,WAAW,CAAC,KAAK,IAAK;QACjI,mEAAmE;QACnE,IAAI,UAAU;QACd,IAAI,EAAE,gBAAgB,IAAI,EAAE,gBAAgB,CAAC,iBAAiB,EAAE,UAAU,EAAE,gBAAgB,CAAC,iBAAiB;aACzG,IAAI,EAAE,IAAI,EAAE;YACf,IAAI,OAAO,EAAE,IAAI,KAAK,UAAU,UAAU,EAAE,IAAI;iBAC3C,IAAI,OAAO,EAAE,IAAI,KAAK,UAAU,UAAU,EAAE,IAAI,CAAC,IAAI,IAAI,EAAE,IAAI,CAAC,iBAAiB,IAAI,KAAK,SAAS,CAAC;gBAAE,IAAI,EAAE,IAAI,CAAC,EAAE;YAAC,GAAG,OAAO,CAAC,YAAY,OAAO;QACzJ;QAEA,OAAO;YACL,IAAI,EAAE,EAAE;YACR,MAAM,EAAE,IAAI,IAAI;YAChB,MAAM;YACN,UAAU,EAAE,UAAU,GAAG,GAAG,CAAC,EAAE,UAAU,GAAC,IAAI,EAAE,OAAO,CAAC,GAAG,GAAG,CAAC,GAAI,EAAE,QAAQ,IAAI;YACjF,OAAO,OAAO,QAAQ,CAAC,YAAY,WAAW;YAC9C,aAAa,EAAE,QAAQ,IAAI,EAAE,WAAW,IAAI,EAAE;YAC9C,OAAO,EAAE,KAAK,IAAI;YAClB,OAAO,EAAE,aAAa,IAAI,EAAE,SAAS,IAAI,EAAE,KAAK,IAAI;QACtD;IACF;IAEA,mBAAmB;IACnB,OAAO;QACL,IAAI,EAAE,EAAE;QACR,MAAM,EAAE,IAAI,IAAI;QAChB,MAAM,EAAE,OAAO,IAAI;QACnB,UAAU,EAAE,UAAU,GAAG,GAAG,CAAC,EAAE,UAAU,GAAC,IAAI,EAAE,OAAO,CAAC,GAAG,GAAG,CAAC,GAAI,EAAE,QAAQ,IAAI;QACjF,OAAO,KAAK,GAAG,CAAC,KAAK,KAAK,KAAK,CAAC,CAAC,EAAE,MAAM,IAAI,CAAC,IAAI,IAAI;QACtD,aAAa,EAAE,UAAU,IAAI,EAAE;QAC/B,OAAO,EAAE,KAAK,IAAI;QAClB,OAAO,EAAE,SAAS,IAAI;IACxB;AACF"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/PRO-BLADE/Github/RateYourBarber/web/pages/barber/%5Bid%5D.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { mapApiBarberToUi, UiBarber } from '../../lib/adapters';\nimport { setLastVisitedBarber } from '../../lib/lastVisited';\n\ntype Props = {\n  barberRaw: any | null;\n};\n\nexport default function BarberProfilePage({ barberRaw }: Props): JSX.Element {\n  const router = useRouter();\n  const barber = barberRaw ? mapApiBarberToUi(barberRaw) : null;\n\n  useEffect(() => {\n    if (!barberRaw) return;\n    try {\n      setLastVisitedBarber({\n        id: barberRaw.id,\n        name: barberRaw.name || '',\n        shop: (barberRaw.primary_location && (barberRaw.primary_location.name || barberRaw.primary_location.formatted_address)) || (barberRaw.shop && barberRaw.shop.name) || '',\n        timestamp: Date.now(),\n      });\n    } catch (e) {}\n  }, [barberRaw]);\n\n  if (!barberRaw || !barber) return <div>No barber found</div>;\n\n  const barberVerified = barberRaw.verified === true || barberRaw.is_verified === true || !!barberRaw.verified_at || barberRaw.status === 'verified';\n  const shop = barberRaw.primary_location || barberRaw.shop || null;\n  const shopVerified = !!shop && (shop.verified === true || shop.is_verified === true || !!shop.verified_at || shop.status === 'verified');\n\n  const hasBusinessProfile = barberRaw.business_profile === true || barberRaw.has_business_profile === true || !!barberRaw.business_profile_id;\n\n  const creditsBarber = Number(barberRaw.credits || barberRaw.reward_points || 0);\n  const creditsShop = Number(shop && (shop.credits || shop.reward_points) ? (shop.credits || shop.reward_points) : 0);\n  const combinedCredits = creditsBarber + creditsShop;\n\n  return (\n    <main style={{ padding: 20 }}>\n      <div style={{ marginBottom: 12 }}>\n        <button onClick={() => router.back()} style={{ padding: '6px 10px' }}>\n          ← Back\n        </button>\n      </div>\n      <h1>{barber.name}</h1>\n      <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>\n        {barber.thumb ? <img src={barber.thumb} alt={`${barber.name} thumb`} style={{ width: 140, height: 140, objectFit: 'cover', borderRadius: 6 }} /> : null}\n        <div>\n          <p style={{ margin: 0 }}><strong>Shop:</strong> {barber.shop || 'Independent'}</p>\n          <p style={{ margin: 0 }}><strong>Distance:</strong> {barber.distance}</p>\n          <p style={{ margin: 0 }}><strong>Trust:</strong> {barber.trust}</p>\n        </div>\n      </div>\n\n      <section style={{ marginTop: 18 }}>\n        <h2>Verification</h2>\n        <p>\n          <strong>Barber verified:</strong> {barberVerified ? 'Yes' : 'No'}\n          {' '}\n          <strong>Shop verified:</strong> {shopVerified ? 'Yes' : 'No'}\n        </p>\n        <p>\n          <strong>Business profile:</strong> {hasBusinessProfile ? 'Exists' : 'None'}\n        </p>\n      </section>\n\n      <section style={{ marginTop: 18 }}>\n        <h2>Credits</h2>\n        <p><strong>Barber credits:</strong> {creditsBarber}</p>\n        <p><strong>Shop credits:</strong> {creditsShop}</p>\n        <p><strong>Combined credits:</strong> {combinedCredits}</p>\n        <p style={{ color: '#555' }}>If both the barber and the shop are verified, the barber can earn credits from both pages.</p>\n      </section>\n\n      {barberRaw.reviews && barberRaw.reviews.length > 0 && (\n        <section style={{ marginTop: 18 }}>\n          <h2>Recent comments</h2>\n          <div>\n            {barberRaw.reviews.map((r: any) => (\n              <div key={r.id} style={{ padding: '10px 0', borderBottom: '1px solid #eee' }}>\n                <p style={{ margin: 0 }}>\n                  <strong>{r.sanitized ? 'Summary' : 'Comment'}</strong>\n                  {r.rating ? ` — ${r.rating}/5` : ''}\n                  <span style={{ color: '#666', marginLeft: 8 }}>{r.created_at ? new Date(r.created_at).toLocaleDateString() : ''}</span>\n                </p>\n                <p style={{ margin: '6px 0 0' }}>{r.summary || 'No text available'}</p>\n                {r.sanitized && <p style={{ fontSize: 12, color: '#666', margin: '6px 0 0' }}>Sanitized summary (LLM)</p>}\n              </div>\n            ))}\n          </div>\n        </section>\n      )}\n\n      <section style={{ marginTop: 18 }}>\n        <h2>Actions</h2>\n        {!hasBusinessProfile && (\n          <button onClick={() => alert('Claim Business Profile flow not yet implemented')} style={{ padding: '8px 12px' }}>\n            Claim Business Profile\n          </button>\n        )}\n        {hasBusinessProfile && (\n          <button onClick={() => alert('Manage business profile (not implemented)')} style={{ padding: '8px 12px' }}>\n            Manage Business Profile\n          </button>\n        )}\n      </section>\n\n      {shop && (\n        <section style={{ marginTop: 18 }}>\n          <h2>Shop</h2>\n          <p><strong>Name:</strong> {shop.name || shop.formatted_address || barber.shop}</p>\n          <p><strong>Verified:</strong> {shopVerified ? 'Yes' : 'No'}</p>\n          {shop.id ? (\n            <p><a href={`/shop/${shop.id}`}>Open shop page</a></p>\n          ) : null}\n        </section>\n      )}\n    </main>\n  );\n}\n\nexport async function getServerSideProps(context: any) {\n  const { id } = context.params || {};\n  const apiBase = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000';\n  try {\n    const res = await fetch(`${apiBase}/api/barbers/${id}`);\n    if (res.status === 404) return { notFound: true };\n    if (!res.ok) return { props: { barberRaw: null } };\n    const barberRaw = await res.json();\n    return { props: { barberRaw } };\n  } catch (e) {\n    return { props: { barberRaw: null } };\n  }\n}\n"],"names":[],"mappings":"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"}}]
}